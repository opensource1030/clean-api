## Customize the test machine
machine:
  php:
    version: 7.0.4

  timezone:
    America/New_York # Set the timezone

  environment:
      CIRCLE_ENV: test

## Customize dependencies
dependencies:
  pre:
    - sed -i 's/^;//' ~/.phpenv/versions/$(phpenv global)/etc/conf.d/xdebug.ini
    - mkdir -p build/logs/coverage_html
    # - curl https://raw.githubusercontent.com/pytlesk4/stoplight-todos/master/prism.sh | sh


  override:
    - composer install --prefer-source --no-interaction
    - bundle install
    # - prism test -s https://api.stoplight.io/v1/versions/anvGNGR9siLLbDhR8/export/oas.json


test:
  override:
    - cp .env.test .env
    - php vendor/bin/phpunit -c phpunit.xml --exclude-group need-review --coverage-clover build/logs/clover.xml -d memory_limit=2048M  
  post:
    - cp -r build/logs/clover.xml $CIRCLE_ARTIFACTS
    - php vendor/bin/coveralls -v

deployment:
  development:
    branch: master
    commands:
      - bundle exec cap staging deploy
      - bundle exec cap trial deploy
      
general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore

notify:
  webhooks:
    # A list of hook hashes, containing the url field
    - url: https://lit-sea-4960.herokuapp.com/build/
